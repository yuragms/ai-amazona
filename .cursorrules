# Cursor Rules

## Instructions

- Record fixes for mistakes or corrections to avoid repetition in the `Lessons` section.
- Before installing Shadcn components, check the `components/ui` folder to see what is already there and avoid duplicates.
- Organize thoughts and plan steps before starting a task in the `Scratchpad` section.
- Clear old tasks if necessary.
- Use todo markers for progress tracking:
  - `[X]` Completed tasks
  - `[ ]` Pending tasks
- Update Scratchpad after completing subtasks.
- Reflect and plan after milestones for better task management.
- Always refer to Scratchpad before planning the next step.

## Lessons

## Scratchpad

Development steps for ecommerce website (Amazon-like) with admin dashboard.

**Stack:** TypeScript, Next.js 16, Shadcn, Lucide, Zod, Zustand, Recharts, Resend, Uploadthing, Prisma, PostgreSQL, next-auth@beta, Stripe.

---

### 1. Project Setup and Configuration [X]

- [x] Initialize Next.js 16 with TypeScript, App Router, Tailwind
- [x] Set up folder structure: `app/(shop)`, `app/(admin)`, `app/(auth)`, `lib`, `components`, `hooks`
- [x] Install and configure Shadcn UI: `npx shadcn@latest init`
- [x] Add Shadcn components as needed (Button, Card, Input, Form, Table, Dialog, etc.)
- [x] Install Lucide React for icons
- [x] Install Zod for schema validation (forms, API)
- [x] Install Zustand for client state (cart, UI)
- [x] Install Recharts for admin charts
- [x] Install Resend SDK for transactional emails
- [ ] Set up Uploadthing (app + API route) for product images
- [x] Install Prisma, configure PostgreSQL (DATABASE_URL)
- [x] Install next-auth@beta (v5), configure auth route and session
- [ ] Install Stripe (server + client), set webhook route
- [x] Add env validation with Zod (.env.local template)

### 2. Database and Auth [~]

- [x] Define Prisma schema: User, Account, Session (NextAuth), Product, Category, Order, OrderItem, Review, CartItem, Address
- [x] Add roles: `user` / `admin` (e.g. on User or separate Admin model)
- [ ] Run migrations, seed categories and sample products
- [x] Configure next-auth@beta: Credentials provider, JWT strategy, callbacks for role (auth.ts, auth.config.ts, proxy)
- [x] OAuth (Google/GitHub)
- [x] Protect routes: proxy for `/admin/*` (admin only), `/dashboard/*` (authenticated)
- [ ] Create auth API helpers: `auth()` in server components, session in client via provider

### 3. Core Features - Customer Side [ ]

- [x] Home Layout:
  - Create `(home)` folder in `app` directory
  - Header with logo, search bar, and navigation
  - Footer with links and social media
- [x] Homepage:
  - banner carousel
  - latest products
- [x] Products Catalog:
  - Sidebar with categories and filters
  - Search results
  - Product grid
  - Pagination
- [ ] Product pages:
  - Create product detail page layout
  - Implement image gallery with thumbnails
  - Add product information section:
    - Title, price, description
    - Stock status
    - Add to cart button
  - Reviews and ratings section:
    - Display existing reviews
    - Add review form for authenticated users
    - Star rating component
  - Related products section:
    - Show products from same category
    - Product card carousel
- [ ] Shopping cart:
  - Add/remove items
  - Update quantities
  - Cart persistence
- [ ] Checkout process:
  - Shipping information
  - Payment integration (Stripe)
  - Order confirmation
- [ ] User dashboard:
  - Order history
  - Profile management
  - Saved addresses
  - Wishlist


### 4. Admin Dashboard [ ]

- [ ] **Layout:** `app/(admin)/admin/layout` — sidebar nav (Lucide icons), restrict to `role === 'admin'`
- [ ] **Overview:** Recharts — revenue over time (line), orders (bar), key metrics cards (total revenue, orders, customers, AOV); data from Prisma aggregates
- [ ] **Products:** CRUD table (Shadcn Table), create/edit form with Zod; images via Uploadthing
- [ ] **Orders:** List orders, filters (status, date), detail view, status updates
- [ ] **Users:** List users, toggle admin (if applicable)
- [ ] **Low stock / reports:** Optional — low stock list, export (CSV) using Recharts/data from Prisma

### 5. Emails and Payments [ ]

- [ ] Resend: Order confirmation, shipping update, password reset (if using credentials); use Server Actions or API routes
- [ ] Stripe: Checkout Session creation, webhook for `checkout.session.completed` / `payment_intent.succeeded` — create Order and OrderItems, update inventory
- [ ] Store Stripe customer/session IDs if needed for receipts or portal

### 6. Polish and Deploy [ ]

- [ ] Loading and error states (Shadcn skeletons, error boundaries)
- [ ] SEO: metadata, Open Graph for product pages
- [ ] Security: validate all inputs with Zod, rate limit auth/checkout, secure env
- [ ] Deploy: Vercel (or other), PostgreSQL (e.g. Neon/Supabase), set env for Stripe webhook, Resend, Uploadthing, NextAuth URL
- [ ] Optional: tests (e.g. Vitest + Playwright), CI (lint, typecheck, build)

### 7. Documentation [ ]

- [ ] API documentation
- [ ] User guide
- [ ] Admin documentation
- [ ] Deployment guide